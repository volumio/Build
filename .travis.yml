language: bash

sudo: required

before_script:
 - sudo apt-get --yes --no-install-recommends install binfmt-support qemu-user-static
 - echo ':arm:M::\x7fELF\x01\x01\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x02\x00\x28\x00:\xff\xff\xff\xff\xff\xff\xff\x00\xff\xff\xff\xff\xff\xff\xff\xff\xfe\xff\xff\xff:/usr/bin/qemu-arm-static:' | sudo tee -a /proc/sys/fs/binfmt_misc/register
   # Install shellcheck. Workaround for this issue: https://github.com/travis-ci/travis-ci/issues/8823
 - curl -sSL "https://ftp-master.debian.org/keys/archive-key-7.0.asc" | sudo -E apt-key add -
 - echo "deb http://ftp.us.debian.org/debian unstable main contrib non-free" | sudo tee -a /etc/apt/sources.list > /dev/null
 - sudo apt-get update
 - sudo apt-get install -y shellcheck

services:
 - docker

env:
 - ARCH=arm BOARD=pi
 - ARCH=arm BOARD=sparky
 - ARCH=arm BOARD=bbb
 - ARCH=arm BOARD=bpim2u
 - ARCH=armv7 BOARD=cuboxi
 - ARCH=armv7 BOARD=odroidc1
 - ARCH=armv7 BOARD=odroidc2
 - ARCH=armv7 BOARD=odroidxu4
 - ARCH=armv7 BOARD=odroidx2
 - ARCH=armv7 BOARD=udooneo
 - ARCH=armv7 BOARD=udooqdl
 - ARCH=armv7 BOARD=pine64
 - ARCH=armv7 BOARD=nanopi64
 - ARCH=armv7 BOARD=bpipro
 - ARCH=armv7 BOARD=tinkerboard
 - ARCH=armv7 BOARD=sopine64
 - ARCH=armv7 BOARD=rock64
 - ARCH=armv7 BOARD=voltastream0
 - ARCH=armv7 BOARD=nanopineo
 - ARCH=armv7 BOARD=nanopineo2
 - ARCH=x86 BOARD=x86

script:
 - find . -iname "*.sh" -exec shellcheck "{}" \;
 - ./docker-build.sh -b ${ARCH} -d ${BOARD} -v 2.$(git rev-list HEAD --count)

matrix:
  fast_finish: true
